# Design-First Enforcement Extension

## Template Generation Guide for End-User Projects
**Purpose:** Generate design-first enforcement templates that ensure proper design before implementation in end-user projects.

### Template Generation Logic
This extension guides the framework to generate comprehensive design validation templates for end-user projects with the following components:

#### 1. Design Document Template Structure
**Template Output:** `docs/design.md` template with guided sections
```markdown
# [PROJECT_NAME] Design Document

## Requirements
<!-- TODO: Define functional and non-functional requirements -->
- [ ] Core functionality requirements
- [ ] Performance requirements  
- [ ] Integration requirements
- [ ] PocketFlow pattern identification: [AGENT|WORKFLOW|RAG|MAPREDUCE|MULTI-AGENT]

## Flow Design  
<!-- TODO: Create Mermaid diagram showing data flow -->
\`\`\`mermaid
graph TD
    A[Input] --> B[Processing]
    B --> C[Output]
    %% TODO: Replace with actual workflow design
\`\`\`

## Data Design
<!-- TODO: Define SharedStore schema and data models -->
- Input Schema: TODO - Define Pydantic models
- Output Schema: TODO - Define Pydantic models
- Intermediate Data: TODO - Define data structures

## Node Design
<!-- TODO: Define PocketFlow nodes with prep/exec/post pattern -->
- Preparation Nodes: TODO - Data validation and preprocessing
- Execution Nodes: TODO - Core business logic
- Post-processing Nodes: TODO - Output formatting and validation

## Utilities
<!-- TODO: Define utility functions with input/output contracts -->
- Helper Functions: TODO - Reusable utility functions
- Integration Points: TODO - External API integrations
```

#### 2. Validation Script Template
**Template Output:** `scripts/validate_design.sh` for end-user projects
```bash
#!/bin/bash
# Design validation script for [PROJECT_NAME]
# Auto-generated by Agent OS + PocketFlow framework

set -e

# TODO: Customize validation logic for your project requirements

validate_design_document() {
    echo "üîç Validating design document..."
    
    local design_file="docs/design.md"
    local validation_errors=()
    
    # Check design document exists
    if [[ ! -f "$design_file" ]]; then
        echo "‚ùå Design document missing: $design_file"
        echo "üí° Create design document: claude-code agent invoke pocketflow-orchestrator --task full-lifecycle --phase design --feature $(basename $(pwd))"
        return 1
    fi
    
    # TODO: Implement section validation
    local required_sections=("Requirements" "Flow Design" "Data Design" "Node Design")
    for section in "${required_sections[@]}"; do
        if ! grep -q "^## $section" "$design_file"; then
            validation_errors+=("Missing section: $section")
        fi
    done
    
    # TODO: Implement Mermaid diagram validation
    if ! grep -q "\`\`\`mermaid" "$design_file"; then
        validation_errors+=("Missing Mermaid diagram")
    fi
    
    # TODO: Implement pattern identification validation
    local patterns=("AGENT" "WORKFLOW" "RAG" "MAPREDUCE" "MULTI-AGENT")
    local pattern_found=false
    for pattern in "${patterns[@]}"; do
        if grep -q "$pattern" "$design_file"; then
            pattern_found=true
            break
        fi
    done
    
    if [[ "$pattern_found" == false ]]; then
        validation_errors+=("PocketFlow pattern not identified")
    fi
    
    # Report validation results
    if [[ ${#validation_errors[@]} -gt 0 ]]; then
        echo "‚ùå Design validation failed:"
        for error in "${validation_errors[@]}"; do
            echo "  - $error"
        done
        echo "üí° Fix issues and run: ./scripts/validate_design.sh"
        return 1
    fi
    
    echo "‚úÖ Design document validation passed"
    return 0
}

# TODO: Integrate with your CI/CD pipeline
validate_design_document
```

#### 3. Pre-commit Hook Template  
**Template Output:** `.git/hooks/pre-commit` for design-first enforcement
```bash
#!/bin/bash
# Pre-commit hook for design-first enforcement
# TODO: Enable this hook by making it executable: chmod +x .git/hooks/pre-commit

# Check if this is a feature branch
if git branch --show-current | grep -q "feature/"; then
    echo "üîç Design-first enforcement: Validating design document..."
    
    # TODO: Customize validation trigger logic
    if ! ./scripts/validate_design.sh; then
        echo "‚ùå COMMIT BLOCKED: Design document validation failed"
        echo "üí° Complete design document before implementing features"
        exit 1
    fi
fi
```

### Integration with PocketFlow Orchestrator
This extension generates templates that seamlessly integrate with the pocketflow-orchestrator agent:

#### Orchestrator Integration Template
```bash
# TODO: Add to your project's validation workflow

invoke_design_orchestrator() {
    local task="$1"
    echo "ü§ñ Invoking PocketFlow orchestrator for design task: $task"
    
    case "$task" in
        "create-design")
            claude-code agent invoke pocketflow-orchestrator \
                --task "full-lifecycle" \
                --feature "$(basename $(pwd))" \
                --phase "design"
            ;;
        "complete-design") 
            claude-code agent invoke pocketflow-orchestrator \
                --task "quality-check" \
                --phase "design" \
                --scope "design-completeness"
            ;;
        "validate-design")
            claude-code agent invoke pocketflow-orchestrator \
                --task "quality-check" \
                --phase "design"
            ;;
    esac
}
```

### Usage in End-User Projects
When deployed to end-user projects, this extension provides:

1. **Automatic Template Generation**: Creates design.md template with guided TODOs
2. **Validation Scripts**: Ready-to-use validation with customizable logic  
3. **Orchestrator Integration**: Seamless integration with pocketflow-orchestrator
4. **Git Hooks**: Optional pre-commit enforcement
5. **Clear Implementation Guidance**: Step-by-step TODO instructions

### Framework Integration Points
This extension integrates with the framework's generator.py system to:
- Detect when design-first enforcement is needed
- Generate appropriate templates based on project type
- Provide clear customization guidance for end-users
- Maintain consistency with PocketFlow methodology
